<!DOCTYPE html>
<html lang="en">
<head>
    <title>Drone Controller</title>
    <meta charset="UTF-8">
    <script src="https://cdn.socket.io/socket.io-3.0.0.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="controller.css">
</head>
<body>
    <div class="controller">
        <div class="button" id="upButton">Up</div>
        <div class="button" id="forwardButton">Forward</div>
        <div class="leftright-container">
            <div class="button" id="leftButton">Left</div>
            <div class="button" id="rightButton">Right</div>
        </div>
        <div class="button" id="backwardButton">Backward</div>
        <div class="button" id="downButton">Down</div>
    </div>
    <div class="picture-container">
        <!-- Placeholder image, replace with your actual image source -->
        <img src="drone.jpg" alt="Drone" class="drone-picture">
    </div>
    <script>
        const socketURL = sessionStorage.getItem('socketURL');
        const socket = io(socketURL, {
            transports: ['websocket'],
        });

        // Function to send WebSocket signal
        function sendWebSocketSignal(direction) {
            socket.emit('message', direction);
        }

        // Function to monitor button state
        function monitorButtonState(element, direction) {
            let isPressed = false;

            // Function to send WebSocket signal while pressed
            function sendWebSocketSignalWhilePressed() {
                if (isPressed) {
                    sendWebSocketSignal(direction);
                    setTimeout(sendWebSocketSignalWhilePressed, 100); // Adjust the interval as needed
                }
            }

            element.addEventListener('mousedown', () => {
                isPressed = true;
                sendWebSocketSignalWhilePressed();
            });

            element.addEventListener('mouseup', () => {
                isPressed = false;
                socket.emit('message', 'stop');
            });

            // For touch devices
            element.addEventListener('touchstart', (event) => {
                event.preventDefault();
                isPressed = true;
                sendWebSocketSignalWhilePressed();
            });

            element.addEventListener('touchend', (event) => {
                event.preventDefault();
                isPressed = false;
                socket.emit('message', 'stop');
            });

            // Click event
            element.addEventListener('click', () => {
                sendWebSocketSignal(direction);
            });
        }

        // Monitor button state for each button
        monitorButtonState(document.getElementById('upButton'), 'up');
        monitorButtonState(document.getElementById('downButton'), 'down');
        monitorButtonState(document.getElementById('leftButton'), 'left');
        monitorButtonState(document.getElementById('rightButton'), 'right');
        monitorButtonState(document.getElementById('forwardButton'), 'forward');
        monitorButtonState(document.getElementById('backwardButton'), 'backward');
    </script>
</body>
</html>
